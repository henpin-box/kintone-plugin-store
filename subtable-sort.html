<!DOCTYPE html>
<html lang="ja" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>サブテーブル並び替え（昇順/降順） | Kintone向けミニプラグイン</title>
    <meta name="description" content="明細をワンクリで昇順/降順。空欄は末尾、数値/日付も自動認識。">
    <meta property="og:title" content="サブテーブル並び替え（昇順/降順） | Kintone向けミニプラグイン">
    <meta property="og:description" content="明細をワンクリで昇順/降順。空欄は末尾、数値/日付も自動認識。">
    <meta property="og:type" content="product">
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="kb-root" data-kb-theme="light">
        <!-- 言語・通貨切り替え -->
        <div class="kb-language-switcher">
            <div class="kb-container">
                <div class="kb-switcher-controls">
                    <div class="kb-lang-toggle">
                        <button class="kb-lang-btn active" data-lang="ja">日本語</button>
                        <button class="kb-lang-btn" data-lang="en">English</button>
                    </div>
                    <div class="kb-currency-toggle">
                        <button class="kb-currency-btn active" data-currency="jpy">JPY (¥)</button>
                        <button class="kb-currency-btn" data-currency="usd">USD ($)</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 商品ヒーロー -->
        <section class="kb-product-hero">
            <div class="kb-container">
                <a href="../index.html#products" class="kb-back-link" data-i18n="buttons.backToList">← 商品一覧に戻る</a>
                
                <div class="kb-product-header">
                    <div>
                        <h1 class="kb-product-title" id="product-title">サブテーブル並び替え（昇順/降順）</h1>
                        <p class="kb-product-summary" id="product-summary">明細をワンクリで昇順/降順。空欄は末尾、数値/日付も自動認識。</p>
                        
                        <div class="kb-tags" id="product-tags">
                            <span class="kb-tag">編集画面</span>
                            <span class="kb-tag">サブテーブル</span>
                            <span class="kb-tag">並び替え</span>
                        </div>
                        
                        <div class="kb-product-meta">
                            <span class="kb-product-price" id="product-price">¥300</span>
                        </div>
                        
                        <div class="kb-product-actions">
                            <a href="https://stores.jp/example/subtable-sort" id="purchase-btn" class="kb-btn kb-btn-primary" target="_blank" rel="noopener" data-i18n="buttons.purchase">購入</a>
                        </div>
                    </div>
                    
                    <div class="kb-product-image">
                        <img src="../assets/placeholder.svg" alt="サブテーブル並び替えプラグイン" width="300" height="200" loading="lazy">
                    </div>
                </div>
            </div>
        </section>

        <!-- 商品詳細情報 -->
        <section class="kb-section">
            <div class="kb-container">
                <div class="kb-info-grid">
                    <div class="kb-info-item">
                        <h3 data-i18n="product.screens">対応画面</h3>
                        <p id="product-screens">PC / 編集・新規</p>
                    </div>
                    <div class="kb-info-item">
                        <h3 data-i18n="product.tags">カテゴリ</h3>
                        <p data-i18n="product.category">編集効率化</p>
                    </div>
                    <div class="kb-info-item">
                        <h3 data-i18n="product.fileSize">ファイルサイズ</h3>
                        <p data-i18n="product.fileSizeValue">約15KB</p>
                    </div>
                    <div class="kb-info-item">
                        <h3 data-i18n="product.lastUpdated">更新日</h3>
                        <p data-i18n="product.lastUpdatedValue">2024年8月</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 機能詳細 -->
        <section class="kb-section">
            <div class="kb-container">
                <h2 class="kb-section-title" data-i18n="product.features">機能</h2>
                <ul class="kb-feature-list" id="product-features">
                    <li>昇順/降順/元に戻す</li>
                    <li>空欄は末尾</li>
                    <li>保存で順序維持</li>
                </ul>
            </div>
        </section>

        <!-- スクリーンショット -->
        <section class="kb-section">
            <div class="kb-container">
                <h2 class="kb-section-title" data-i18n="product.screenshots">スクリーンショット</h2>
                <div class="kb-screenshots">
                    <img src="../assets/placeholder.svg" alt="サブテーブル並び替え - 操作画面" loading="lazy">
                    <img src="../assets/placeholder.svg" alt="サブテーブル並び替え - 結果画面" loading="lazy">
                </div>
            </div>
        </section>

        <!-- 使い方 -->
        <section class="kb-section">
            <div class="kb-container">
                <h2 class="kb-section-title" data-i18n="product.howToUse">使い方</h2>
                <div class="kb-steps">
                    <div class="kb-step">
                        <div class="kb-step-number">1</div>
                        <h3 data-i18n="product.step1.title">プラグインをインストール</h3>
                        <p data-i18n="product.step1.description">Kintoneシステム管理からプラグインファイルをアップロードしてください。</p>
                    </div>
                    <div class="kb-step">
                        <div class="kb-step-number">2</div>
                        <h3 data-i18n="product.step2.title">アプリに追加</h3>
                        <p data-i18n="product.step2.description">対象アプリの設定からプラグインを有効化してください。</p>
                    </div>
                    <div class="kb-step">
                        <div class="kb-step-number">3</div>
                        <h3 data-i18n="product.step3.title">サブテーブルで並び替え</h3>
                        <p data-i18n="product.step3.description">編集画面でサブテーブルのヘッダーをクリックして並び替えできます。</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 制限事項 -->
        <section class="kb-section">
            <div class="kb-container">
                <h2 class="kb-section-title" data-i18n="product.limitations">制限事項</h2>
                <ul class="kb-limitation-list" id="product-limitations">
                    <li>大規模行数では時間がかかる場合あり</li>
                </ul>
            </div>
        </section>

        <!-- FAQ -->
        <section class="kb-section">
            <div class="kb-container">
                <h2 class="kb-section-title" data-i18n="product.faq">よくある質問</h2>
                <div class="kb-faq" id="product-faq">
                    <div class="kb-faq-item">
                        <h3 class="kb-faq-question">モバイル対応は？</h3>
                        <p class="kb-faq-answer">現状PCのみ。要望があれば対応予定。</p>
                    </div>
                    <div class="kb-faq-item">
                        <h3 class="kb-faq-question">どのフィールドタイプに対応していますか？</h3>
                        <p class="kb-faq-answer">文字列、数値、日付、時刻などの基本フィールドに対応しています。計算フィールドや添付ファイルは対象外です。</p>
                    </div>
                    <div class="kb-faq-item">
                        <h3 class="kb-faq-question">並び替えの順序は保存されますか？</h3>
                        <p class="kb-faq-answer">はい。レコード保存時に並び替えた順序が維持されます。</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 関連商品 -->
        <section class="kb-section">
            <div class="kb-container">
                <h2 class="kb-section-title" data-i18n="product.relatedProducts">関連商品</h2>
                <div class="kb-related-products">
                    <div class="kb-related-item">
                        <h3><a href="copy-field.html" data-i18n="product.relatedProduct1">フィールド値一括コピー</a></h3>
                        <p>¥200</p>
                        <a href="copy-field.html" class="kb-btn" data-i18n="buttons.details">詳細</a>
                    </div>
                    <div class="kb-related-item">
                        <h3><a href="list-aggregate.html" data-i18n="product.relatedProduct2">一覧画面集計表示</a></h3>
                        <p>¥400</p>
                        <a href="list-aggregate.html" class="kb-btn" data-i18n="buttons.details">詳細</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- 購入CTA -->
        <section class="kb-purchase-cta">
            <div class="kb-container">
                <h2 data-i18n="product.ctaTitle">サブテーブル並び替えを今すぐ導入</h2>
                <p data-i18n="product.ctaDescription">作業効率を向上させる並び替え機能をお試しください。</p>
                <a href="https://stores.jp/example/subtable-sort" id="purchase-cta-btn" class="kb-btn kb-btn-primary" target="_blank" rel="noopener" data-i18n="buttons.purchase">購入する</a>
            </div>
        </section>

        <!-- フッター -->
        <footer class="kb-footer">
            <div class="kb-container">
                <div class="kb-footer-content">
                    <p class="kb-footer-copyright" data-i18n="footer.copyright">&copy; 2024 Kintone Mini Plugins. All rights reserved.</p>
                    <div class="kb-footer-links">
                        <a href="mailto:support@example.com" class="kb-footer-link" data-i18n="footer.bugReport">不具合報告</a>
                        <a href="../index.html#terms" class="kb-footer-link" data-i18n="footer.terms">利用規約</a>
                    </div>
                </div>
            </div>
        </footer>

        <!-- トースト通知 -->
        <div id="toast" class="kb-toast" style="display: none;"></div>
    </div>

    <script>
        // 個別商品ページ用のスクリプト
        let currentLang = 'ja';
        let currentCurrency = 'jpy';
        let translations = {};
        let productData = null;

        // 翻訳データをロード
        async function loadTranslations() {
            try {
                const response = await fetch('../translations.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                translations = await response.json();
            } catch (error) {
                console.error('翻訳データの読み込みに失敗しました:', error);
                translations = {
                    ja: { site: { title: 'Kintone向けミニプラグイン' } },
                    en: { site: { title: 'Kintone Mini Plugins' } }
                };
            }
        }

        // 商品データをロード
        async function loadProductData() {
            try {
                const response = await fetch('../products.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const products = await response.json();
                productData = products.find(product => product.slug === 'subtable-sort');
                
                if (productData) {
                    updateProductDisplay();
                }
            } catch (error) {
                console.error('商品データの読み込みに失敗しました:', error);
            }
        }

        // 商品表示を更新
        function updateProductDisplay() {
            if (!productData) return;

            const title = currentLang === 'en' ? (productData.titleEn || productData.title) : productData.title;
            const summary = currentLang === 'en' ? (productData.summaryEn || productData.summary) : productData.summary;
            const tags = currentLang === 'en' ? (productData.tagsEn || productData.tags) : productData.tags;
            const price = currentCurrency === 'usd' ? productData.priceUsd || Math.round(productData.price / 130) : productData.price;
            const currency = currentCurrency === 'usd' ? '$' : '¥';
            const storesUrl = currentLang === 'en' ? (productData.storesUrlEn || productData.storesUrl) : productData.storesUrl;
            const screens = currentLang === 'en' ? (productData.screensEn || productData.screens) : productData.screens;
            const features = currentLang === 'en' ? (productData.featuresEn || productData.features) : productData.features;
            const limitations = currentLang === 'en' ? (productData.limitationsEn || productData.limitations) : productData.limitations;
            const faq = currentLang === 'en' ? (productData.faqEn || productData.faq) : productData.faq;

            // タイトルとメタ情報を更新
            document.getElementById('product-title').textContent = title;
            document.getElementById('product-summary').textContent = summary;
            document.getElementById('product-price').textContent = `${currency}${price}`;
            document.getElementById('product-screens').textContent = screens;
            
            // ページタイトルとmeta情報を更新
            const siteTitle = getTranslation('site.title') || 'Kintone向けミニプラグイン';
            document.title = `${title} | ${siteTitle}`;
            
            // meta description更新
            const metaDescription = document.querySelector('meta[name="description"]');
            if (metaDescription) {
                metaDescription.setAttribute('content', summary);
            }
            
            // og:title更新
            const ogTitle = document.querySelector('meta[property="og:title"]');
            if (ogTitle) {
                ogTitle.setAttribute('content', `${title} | ${siteTitle}`);
            }
            
            // og:description更新
            const ogDescription = document.querySelector('meta[property="og:description"]');
            if (ogDescription) {
                ogDescription.setAttribute('content', summary);
            }
            
            // 画像のalt属性更新
            const productImage = document.querySelector('.kb-product-image img');
            if (productImage) {
                const altText = currentLang === 'en' ? `${title} Plugin` : `${title}プラグイン`;
                productImage.setAttribute('alt', altText);
            }

            // タグを更新
            const tagsContainer = document.getElementById('product-tags');
            tagsContainer.innerHTML = tags.map(tag => `<span class="kb-tag">${tag}</span>`).join('');

            // 機能リストを更新
            const featuresContainer = document.getElementById('product-features');
            featuresContainer.innerHTML = features.map(feature => `<li>${feature}</li>`).join('');

            // 制限事項を更新
            const limitationsContainer = document.getElementById('product-limitations');
            limitationsContainer.innerHTML = limitations.map(limitation => `<li>${limitation}</li>`).join('');

            // FAQを更新
            const faqContainer = document.getElementById('product-faq');
            faqContainer.innerHTML = faq.map(item => `
                <div class="kb-faq-item">
                    <h3 class="kb-faq-question">${item.q}</h3>
                    <p class="kb-faq-answer">${item.a}</p>
                </div>
            `).join('');

            // 購入ボタンのURLを更新
            document.getElementById('purchase-btn').href = storesUrl;
            document.getElementById('purchase-cta-btn').href = storesUrl;
            
            // スクリーンショット画像のalt属性更新
            const screenshotImages = document.querySelectorAll('.kb-screenshots img');
            screenshotImages.forEach((img, index) => {
                if (currentLang === 'en') {
                    const altTexts = [
                        `${title} - Operation Screen`,
                        `${title} - Result Screen`
                    ];
                    img.setAttribute('alt', altTexts[index] || `${title} - Screenshot`);
                } else {
                    const altTexts = [
                        `${title} - 操作画面`,
                        `${title} - 結果画面`
                    ];
                    img.setAttribute('alt', altTexts[index] || `${title} - スクリーンショット`);
                }
            });
        }

        // 翻訳取得
        function getTranslation(key) {
            const keys = key.split('.');
            let value = translations[currentLang];
            
            for (const k of keys) {
                if (value && value[k]) {
                    value = value[k];
                } else {
                    return null;
                }
            }
            
            return value;
        }

        // UI要素を翻訳
        function updateUITranslations() {
            const elements = document.querySelectorAll('[data-i18n]');
            elements.forEach(element => {
                const key = element.getAttribute('data-i18n');
                const translation = getTranslation(key);
                if (translation) {
                    element.innerHTML = translation;
                }
            });
            
            // HTML lang属性を更新
            document.getElementById('html-root').setAttribute('lang', currentLang);
        }

        // 言語切り替え
        function switchLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('preferred-language', lang);
            
            document.querySelectorAll('.kb-lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
            });
            
            updateUITranslations();
            updateProductDisplay();
        }

        // 通貨切り替え
        function switchCurrency(currency) {
            currentCurrency = currency;
            localStorage.setItem('preferred-currency', currency);
            
            document.querySelectorAll('.kb-currency-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-currency') === currency);
            });
            
            updateProductDisplay();
        }

        // 設定を復元
        function restoreSettings() {
            const savedLang = localStorage.getItem('preferred-language');
            const savedCurrency = localStorage.getItem('preferred-currency');
            
            if (savedLang && ['ja', 'en'].includes(savedLang)) {
                currentLang = savedLang;
            }
            
            if (savedCurrency && ['jpy', 'usd'].includes(savedCurrency)) {
                currentCurrency = savedCurrency;
            }
            
            document.querySelectorAll('.kb-lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-lang') === currentLang);
            });
            
            document.querySelectorAll('.kb-currency-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-currency') === currentCurrency);
            });
        }

        // イベントリスナーの設定
        function setupEventListeners() {
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('kb-lang-btn')) {
                    const lang = e.target.getAttribute('data-lang');
                    switchLanguage(lang);
                }
                
                if (e.target.classList.contains('kb-currency-btn')) {
                    const currency = e.target.getAttribute('data-currency');
                    switchCurrency(currency);
                }
            });
        }

        // 初期化
        async function init() {
            await loadTranslations();
            await loadProductData();
            restoreSettings();
            updateUITranslations();
            setupEventListeners();
            
            console.log('Product page initialized');
        }

        // DOM読み込み完了時に初期化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>